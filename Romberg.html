
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Romberg</title><meta name="generator" content="MATLAB 9.0"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2016-11-30"><meta name="DC.source" content="Romberg.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#1">NOTES</a></li><li><a href="#2">FUNCTION</a></li></ul></div><h2>NOTES<a name="1"></a></h2><p>Function Read-Me</p><pre class="codeinput"><span class="comment">%int_a^b f(x) using Romberg Integration</span>

<span class="comment">%Adam Diehl</span>
<span class="comment">%Version 1.0</span>
<span class="comment">%Last updated Nov 30, 2016</span>

<span class="comment">%Variables:</span>
<span class="comment">%a = left endpoint</span>
<span class="comment">%b = right endpoint</span>
<span class="comment">%Input 3 is optional manual error tolerance</span>
    <span class="comment">%Default error tolerance is 1e-16</span>

<span class="comment">%Syntax:</span>
    <span class="comment">%Romberg(0,5)</span>
        <span class="comment">%2*x^2-sin(x) [[[When asked for function input]]]</span>
    <span class="comment">%Romberg(-1,3,1e-10)</span>
        <span class="comment">%3*x^-1</span>

<span class="comment">%Note 1: under slow convergence conditions (matrix size = 16x16 with</span>
    <span class="comment">%current solution being at least 10^3*(Error Bound)) the function will</span>
    <span class="comment">%terminate early and spit out a warning. This behavior can be modified</span>
    <span class="comment">%at line 89.</span>

    <span class="comment">%An example of a slowly converging function is:</span>
        <span class="comment">%sin(x^3-erf(x)*tan(x/2))+erf(sin(x)) from 0 to 10</span>
    <span class="comment">%This requires an 18x18 matrix to recover a solution, so setting the</span>
    <span class="comment">%tolerance to n=18 would produce a solution (~1.9688...)</span>

<span class="comment">%Note 2: The accuracy in the error approximation increases with the</span>
    <span class="comment">%accuracy in the integral solution</span>
</pre><h2>FUNCTION<a name="2"></a></h2><pre class="codeinput"><span class="keyword">function</span> out=Romberg(a,b,ErrorBound)

<span class="comment">%Check Inputs</span>
<span class="keyword">if</span> nargin &lt; 3
    ErrorBound = 1e-16;
<span class="keyword">end</span>

<span class="comment">%Enter a function to evaluate. Automatic conversion to characteristic type.</span>
s2 = input(<span class="string">'Enter an integrand, including operators: '</span>, <span class="string">'s'</span>);
s1 = <span class="string">'@(x)'</span>;
S = strcat(s1,s2);
f = str2func(S);

<span class="comment">%Clear screen and display integrand with bounds</span>
clc
fprintf(<span class="string">'Integrating %s from %g to %g: \n'</span>,s2,a,b);

<span class="comment">%Initialize n. n &gt; 1 is necessary to calculate error.</span>
n = 2;

<span class="comment">%End the loop when "done"</span>
done = 0;
<span class="keyword">while</span> done ~= 1;

<span class="comment">%Generate solution matrix</span>
r = zeros(n,n);

<span class="comment">%Calculate initial matrix element</span>
h = b-a;
r(1,1) = (h/2)*(f(a)+f(b)); <span class="comment">%First element</span>

<span class="comment">%Build the matrix</span>
    <span class="comment">%k is row number</span>
<span class="keyword">for</span> k=2:n
    h = h/2;
    <span class="comment">%This is sum from the integration formula</span>
    <span class="keyword">for</span> i = 1:2^(k-2)
        r(k,1) = r(k,1)+f(a+(2*i-1)*h);
    <span class="keyword">end</span>
    <span class="comment">%Fill out the row</span>
    r(k,1) = r(k-1,1)/2+h*r(k,1);

    <span class="comment">%J is column number</span>
    <span class="keyword">for</span> j=2:k
        r(k,j) = r(k,j-1)+(r(k,j-1)-r(k-1,j-1))/(4^(j-1)-1);
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment">%Approximate error</span>
Err = abs(r(k,j-1)-r(k,j));

<span class="comment">%Function return to command window if convergence is extremely slow</span>
<span class="keyword">if</span> n&gt;= 16 &amp;&amp; Err &gt;= 1e3*ErrorBound
    disp(<span class="string">'Slow function convergence detected. Operation terminated.'</span>);
    <span class="keyword">return</span>
<span class="keyword">end</span>

<span class="comment">%End condition for the While loop</span>
<span class="keyword">if</span> Err &lt;= ErrorBound
    done = 1;
<span class="keyword">else</span>
    done = 0;
    n=n+1;
<span class="keyword">end</span>
<span class="keyword">end</span>

out = r(k,j);
</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2016a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% NOTES
% Function Read-Me

%int_a^b f(x) using Romberg Integration

%Adam Diehl
%Version 1.0
%Last updated Nov 30, 2016

%Variables:
%a = left endpoint
%b = right endpoint
%Input 3 is optional manual error tolerance
    %Default error tolerance is 1e-16

%Syntax:
    %Romberg(0,5)
        %2*x^2-sin(x) [[[When asked for function input]]]
    %Romberg(-1,3,1e-10)
        %3*x^-1

%Note 1: under slow convergence conditions (matrix size = 16x16 with 
    %current solution being at least 10^3*(Error Bound)) the function will
    %terminate early and spit out a warning. This behavior can be modified 
    %at line 89.
    
    %An example of a slowly converging function is:
        %sin(x^3-erf(x)*tan(x/2))+erf(sin(x)) from 0 to 10
    %This requires an 18x18 matrix to recover a solution, so setting the
    %tolerance to n=18 would produce a solution (~1.9688...)
    
%Note 2: The accuracy in the error approximation increases with the
    %accuracy in the integral solution

%% FUNCTION

function out=Romberg(a,b,ErrorBound)

%Check Inputs
if nargin < 3
    ErrorBound = 1e-16;
end

%Enter a function to evaluate. Automatic conversion to characteristic type.
s2 = input('Enter an integrand, including operators: ', 's');
s1 = '@(x)';
S = strcat(s1,s2);
f = str2func(S);    

%Clear screen and display integrand with bounds
clc
fprintf('Integrating %s from %g to %g: \n',s2,a,b);

%Initialize n. n > 1 is necessary to calculate error.
n = 2;

%End the loop when "done"
done = 0;
while done ~= 1;

%Generate solution matrix 
r = zeros(n,n);

%Calculate initial matrix element
h = b-a;
r(1,1) = (h/2)*(f(a)+f(b)); %First element

%Build the matrix
    %k is row number
for k=2:n
    h = h/2;
    %This is sum from the integration formula
    for i = 1:2^(k-2)
        r(k,1) = r(k,1)+f(a+(2*i-1)*h);
    end
    %Fill out the row
    r(k,1) = r(k-1,1)/2+h*r(k,1);
    
    %J is column number
    for j=2:k
        r(k,j) = r(k,j-1)+(r(k,j-1)-r(k-1,j-1))/(4^(j-1)-1);
    end
end

%Approximate error
Err = abs(r(k,j-1)-r(k,j));

%Function return to command window if convergence is extremely slow
if n>= 16 && Err >= 1e3*ErrorBound
    disp('Slow function convergence detected. Operation terminated.');
    return
end

%End condition for the While loop
if Err <= ErrorBound
    done = 1;
else
    done = 0;
    n=n+1;
end
end

out = r(k,j);
##### SOURCE END #####
--></body></html>